<div class="container-fluid">
    <div class="row row-principal">
    <div class="row-1" >
        <div class="col-md-6 photo-col">
            <img class="employe-profile-img img-circle" src="../../assets/img/pic-user-font-white.png" alt="pic-user"/>
            <span class="title-posteTravail" *ngIf="posteActuel">
                {{posteActuel.posteTravail.designation}} 
            </span>
            <span class="title-matricule" *ngIf="employeInfos">
                N° Carte CHIFA  : {{employeInfos.numeroSecuriteSociale}}
            </span>   
        </div>
    </div>
    <mat-horizontal-stepper [linear]="true" #stepper>
        <mat-step [stepControl]="firstFormGroup">
            <form [formGroup]="firstFormGroup" class="div-step-1">
                <ng-template matStepLabel>Détail</ng-template>
                <div class="col-md-12 row-title">
                    <h4>Saisir le détail de la visite médicale</h4>
                </div>    
                <div class="col-md-12">
                    <div class="col-md-4">                                    
                        <mat-form-field>
                            <mat-select  matInput placeholder="Type de la visite" formControlName="type" required>
                                <mat-option value="Embauche">Visite d'embauche</mat-option>  
                                <mat-option value="Périodique">Visite périodique</mat-option>    
                                <mat-option value="Reprise">Visite de reprise</mat-option>                                                                              
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-md-4" *ngIf="firstFormGroup.value.type === 'Embauche'" >
                        <mat-form-field>
                            <mat-select placeholder="Poste de travail">
                                <mat-option *ngFor="let posteTravail of posteTravails" [value]="posteTravail.designation">
                                    {{posteTravail.designation}}
                                </mat-option>                  
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-md-4">                                           
                        <mat-form-field>
                            <input matInput [matDatepicker]="pickerDateConsultation" placeholder="Date de la Visite" 
                                formControlName="heureArrivee"  required>
                            <mat-datepicker-toggle matSuffix [for]="pickerDateConsultation"></mat-datepicker-toggle>
                            <mat-datepicker #pickerDateConsultation></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row row-btn">
                    <button class="pull-right btn-cancel"  mat-raised-button routerLink="../../">Annuler</button>                
                        <button class="pull-right btn-save" (click)="onSubmitFirst()" mat-raised-button matStepperNext>Enregister</button>
                </div>
            </form>
        </mat-step>
        <mat-step [stepControl]="secondFormGroup">
            <form [formGroup]="secondFormGroup" class="div-step-2">
                <ng-template matStepLabel>Examen Biométrique</ng-template>
                <!-- contenu d'étape -->
                <div class="col-md-12 row-title">
                    <h4>Saisir les détails d'examen biométrique</h4>
                </div>
                <div class="row-2 col-md-12">
                    <div class="col-md-12 stat-info">
                        <div class="col-md-2">
                            <mat-form-field>
                                <input matInput placeholder="Poids" type="number" formControlName="poids">
                                <span class="matSuffix" matSuffix>kg</span>
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="Taille" type="number" formControlName="taille">
                                <span class="matSuffix" matSuffix>m</span>
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="BMI" formControlName="bmi">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="TT" type="number" formControlName="tt">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="TH" type="number" formControlName="th">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="TT/TH" formControlName="tt_th">
                            </mat-form-field>
                        </div>
                        <div class="col-md-2">
                            <mat-form-field>
                                <input matInput placeholder="Urines" formControlName="urine">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="Ab" formControlName="ab">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="Suc" formControlName="suc">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="Sg" formControlName="sg">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="CC" formControlName="cc">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="PH" formControlName="ph">
                            </mat-form-field>
                        </div>
                        <div class="col-md-2">
                            <p class="title-champ">Audition</p>
                            <mat-form-field>
                                <input matInput placeholder="D" formControlName="auditionD">
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="G" formControlName="auditionG">
                            </mat-form-field>
                        </div>
                        <div class="col-md-6">
                            <div class="col-md-6">
                                <p class="title-champ">Vision sans correction</p>
                                <div class="col-md-6">
                                    <p class="title-champ">D</p>
                                    <mat-form-field>
                                        <input matInput placeholder="De près" formControlName="visionSansCorPD">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput placeholder="De loin" formControlName="visionSansCorLD">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput placeholder="Couleur" formControlName="visionSansCorCD">
                                    </mat-form-field>
                                </div>
                                <div class="col-md-6">
                                    <p class="title-champ">G</p>
                                    <mat-form-field>
                                        <input matInput placeholder="De près" formControlName="visionSansCorPG">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput placeholder="De loin" formControlName="visionSansCorLG">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput placeholder="Couleur" formControlName="visionSansCorCG">
                                    </mat-form-field>
                                </div>
                            </div>    
                            <div class="col-md-6">
                                <p class="title-champ">Vision avec correction</p>
                                <div class="col-md-6">
                                    <p class="title-champ">D</p>
                                    <mat-form-field>
                                        <input matInput placeholder="De près" formControlName="visionAvecCorPD">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput placeholder="De loin" formControlName="visionAvecCorLD">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput placeholder="Couleur" formControlName="visionAvecCorCD">
                                    </mat-form-field>
                                </div>
                                <div class="col-md-6">
                                    <p class="title-champ">G</p>
                                    <mat-form-field>
                                        <input matInput placeholder="De près" formControlName="visionAvecCorPG">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput placeholder="De loin" formControlName="visionAvecCorLG">
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput placeholder="Couleur" formControlName="visionAvecCorCG">
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>           
                    </div>                   
                </div>
                <div class="pull-right btn-step">
                    <button mat-button mat-raised-button matStepperNext class="btn-stepper-suivant">
                        <mat-icon>keyboard_arrow_right</mat-icon>
                    </button>
                </div>
            </form>
        </mat-step>
        <mat-step [stepControl]="thirdFormGroup">
            <form [formGroup]="thirdFormGroup" class="div-step-2">
                <ng-template matStepLabel>Explorations Fonctionnelles</ng-template>
                <!-- contenu d'étape -->
                <div class="col-md-12 row-title">                        
                    <h4>Saisir les details d'explorations fonctionnelles</h4>
                </div>
                <div class="col-md-12">
                    <div class="col-md-4">
                        <mat-form-field>
                            <textarea  class="textArea" matInput placeholder="Fonction respiratoire" FormControleName="fonctionRespiratoire"></textarea>
                        </mat-form-field>    
                    </div>
                    <div class="col-md-4">
                        <mat-form-field>
                            <textarea  class="textArea" matInput placeholder="Fonction circulatoire" FormControleName="fonctionCirculatoire"></textarea>
                        </mat-form-field>    
                    </div>
                    <div class="col-md-4">
                        <mat-form-field>
                            <textarea  class="textArea" matInput placeholder="Fonction motrice" FormControleName="fonctionMotrice"></textarea>
                        </mat-form-field>    
                    </div>
                </div>
                <div class="pull-right btn-step">
                    <button mat-button mat-raised-button matStepperPrevious class="btn-stepper-precedent">                   
                        <mat-icon>keyboard_arrow_left</mat-icon>                    
                    </button>
                    <button mat-button mat-raised-button matStepperNext class="btn-stepper-suivant">
                        <mat-icon>keyboard_arrow_right</mat-icon>
                    </button>
                </div>
            </form>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>Interrogatoire</ng-template>
            <!-- contenu d'étape -->
            <div class="col-md-12 row-title">
                <h4> Réponse d'interegatoire
                    <span class="btn-add">
                        <button mat-mini-fab (click)="addReponse(''+false)">
                            <mat-icon>add</mat-icon>                        
                        </button>
                    </span>
                </h4>
            </div>
                                    
            <div class="pull-right btn-step">
                <button mat-button mat-raised-button matStepperPrevious class="btn-stepper-precedent">                   
                    <mat-icon>keyboard_arrow_left</mat-icon>                    
                </button>
                <button mat-button mat-raised-button matStepperNext class="btn-stepper-suivant">
                    <mat-icon>keyboard_arrow_right</mat-icon>
                </button>
            </div>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>Traitement</ng-template>
            <!-- contenu d'étape -->
                <div class="row col-md-12">
                    <div class="col-md-6">
                        <div class="col-md-12 row-section-TM">
                        <div class="col-md-12 row-title">
                            <h4>Orientations Médicales
                                <span class="btn-add">
                                    <button mat-mini-fab (click)="addOrientation(''+false)">
                                        <mat-icon>add</mat-icon>                        
                                    </button>
                                </span>
                            </h4>
                        </div>
                        <ng-container *ngIf="visite">
                                <ng-container *ngIf="visite.orientationMedicales != null">
                                    <p class="title-champ">Liste des orientations demandés:<span class="champ"></span></p>               
                                    <table mat-table [dataSource]="dataSourceOrientations"  class="mat-elevation-z2">
                            
                                        <!-- Spécialiste  Column -->
                                        <ng-container matColumnDef="specialiste">
                                            <th mat-header-cell *matHeaderCellDef> Spécialiste </th>
                                            <td mat-cell *matCellDef="let row">{{row.specialite}}</td>
                                        </ng-container>    
                                        
                                        <!-- motif  Column -->
                                        <ng-container matColumnDef="motifOrientation">
                                            <th mat-header-cell *matHeaderCellDef> Motif  </th>
                                            <td mat-cell *matCellDef="let row">{{row.motif}} </td>
                                        </ng-container>
            
                                            
                                        <!-- Action edit Column -->
                                        <ng-container matColumnDef="Action-edit">
                                            <th mat-header-cell *matHeaderCellDef ></th>
                                            <td mat-cell *matCellDef="let row" class="td-btn-edit">
                                                <button mat-icon-button (click)="openDialogDetailsConsultation(''+row.idConsultation)">
                                                    <mat-icon>edit</mat-icon>
                                                </button>
                                            </td>
                                        </ng-container>
                                    
                                        <!-- Action delete Column -->
                                        <ng-container matColumnDef="Action-delete">
                                            <th mat-header-cell *matHeaderCellDef ></th>
                                            <td mat-cell *matCellDef="let row" class="td-btn-delete">
                                                <button mat-icon-button (click)="deleteOrientation(row)">
                                                    <mat-icon>delete</mat-icon>
                                                </button>
                                            </td>
                                        </ng-container>
            
                                        <!-- Action rapport Column -->
                                        <ng-container matColumnDef="Action-rapport">
                                            <th mat-header-cell *matHeaderCellDef ></th>
                                            <td mat-cell *matCellDef="let row" class="btn-details">
                                                <button mat-icon-button (click)="genererOrientation(row)">
                                                    <mat-icon>picture_as_pdf</mat-icon>
                                                </button>
                                            </td>
                                        </ng-container>
                                    
                                        <tr mat-header-row *matHeaderRowDef="displayedColumnsOrientations"></tr>
                                        <tr mat-row *matRowDef="let row; columns: displayedColumnsOrientations;">
                                        </tr>
                                    </table>
                                </ng-container>
                        </ng-container>
                    </div>
                    </div>
                    <div class="col-md-6">
                        <div class="col-md-12 row-section-TM">
                        <div class="col-md-12 row-title">
                            <h4>Examens complémentaires
                                <span class="btn-add">
                                    <button mat-mini-fab (click)="addExamen(''+false)">
                                        <mat-icon>add</mat-icon>                        
                                    </button>
                                </span>
                            </h4>
                        </div>
                        <ng-container *ngIf="visite">
                            <ng-container *ngIf="visite.examenComplementaires != null">
                                <p class="title-champ">Liste des examens demandés:<span class="champ"></span></p>                             
                                <table mat-table [dataSource]="dataSourceExamens"  class="mat-elevation-z2">
                        
                                    <!-- Désignation  Column -->
                                    <ng-container matColumnDef="designation">
                                        <th mat-header-cell *matHeaderCellDef> Désignation </th>
                                        <td mat-cell *matCellDef="let row">{{row.designation}}</td>
                                    </ng-container>   
                                    
                                    <!-- Descriptio  Column -->
                                    <ng-container matColumnDef="description">
                                        <th mat-header-cell *matHeaderCellDef> Description </th>
                                        <td mat-cell *matCellDef="let row">{{row.description}}</td>
                                    </ng-container>
            
                                    <!-- Resultat  Column -->
                                    <ng-container matColumnDef="resultat">
                                        <th mat-header-cell *matHeaderCellDef> Résultat </th>
                                        <td mat-cell *matCellDef="let row">{{row.resultat}}</td>
                                    </ng-container>
                                
                                    <!-- Action delete Column -->
                                    <ng-container matColumnDef="Action-delete">
                                        <th mat-header-cell *matHeaderCellDef ></th>
                                        <td mat-cell *matCellDef="let row" class="td-btn-delete">
                                            <button mat-icon-button (click)="deleteExamen(row)">
                                                <mat-icon>delete</mat-icon>
                                            </button>
                                        </td>
                                    </ng-container>
            
                                    <!-- Action result file Column -->
                                    <ng-container matColumnDef="Action-result">
                                        <th mat-header-cell *matHeaderCellDef ></th>
                                        <td mat-cell *matCellDef="let row" class="btn-details">
                                            <button mat-icon-button (click)="showFileExamen(row)">
                                                <mat-icon>picture_as_pdf</mat-icon>
                                            </button>
                                        </td>
                                    </ng-container>
                                
                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsExamens"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsExamens;">
                                    </tr>
                                </table>
                                <button mat-mini-fab class="pull-right btn-pdf" (click)="genererFicheExamen()"><mat-icon>picture_as_pdf</mat-icon></button>
                            </ng-container>
                        </ng-container>
                        </div>
                    </div>        
                </div>
            <div class="pull-right btn-step">
                <button mat-button mat-raised-button matStepperPrevious class="btn-stepper-precedent">                   
                    <mat-icon>keyboard_arrow_left</mat-icon>                    
                </button>
                <button mat-button mat-raised-button matStepperNext class="btn-stepper-suivant">
                    <mat-icon>keyboard_arrow_right</mat-icon>
                </button>
            </div>
        </mat-step>
        <mat-step [stepControl]="fourthFormGroup">
            <form [formGroup]="fourthFormGroup" class="div-step-2">                        
                <ng-template matStepLabel>Avis d'aptitude</ng-template>
                <!-- contenu d'étape -->
                <div class="col-md-12 row-title">
                    <h4>Aptitude de travail au poste de travail</h4>
                </div>    
                <div class="col-md-12">
                    <div class="col-md-4">                                    
                        <mat-form-field>
                            <mat-select  matInput placeholder="Aptitude" formControlName="resultat" required>
                                <mat-option value="Apte">Apte</mat-option>  
                                <mat-option value="Apte avec réserve">Apte avec réserve</mat-option>    
                                <mat-option value="Inapte temporairement">Inapte temporairement</mat-option> 
                                <mat-option value="Inapte définitif">Inapte définitif</mat-option>                                                                              
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-md-4">                                    
                        <mat-form-field *ngIf="fourthFormGroup.value.resultat === 'Apte avec réserve'">
                            <textarea class="textArea" matInput placeholder="Observation" formControlName="conclusionProfessionnelle"></textarea>
                        </mat-form-field>
                    </div>
                    <ng-container *ngIf="fourthFormGroup.value.resultat === 'Inapte temporairement' || fourthFormGroup.value.resultat === 'Inapte définitif'">
                        <div class="col-md-12 row-title">
                            <h4>Réorientation professionnelle
                                <span class="btn-add">
                                    <button mat-mini-fab (click)="addReorientation(''+false,posteActuel)">
                                        <mat-icon>add</mat-icon>                        
                                    </button>
                                </span>
                            </h4>
                        </div>
                    </ng-container>
                </div>
               
                <div class="pull-right btn-step">
                    <button mat-button mat-raised-button  matStepperPrevious class="btn-stepper-precedent">                    
                        <mat-icon>keyboard_arrow_left</mat-icon>                    
                    </button>
                    <button mat-button mat-raised-button (click)="onSubmitFinale()" class="btn-stepper-enregistrer">
                        Terminer
                        <mat-icon>done_all</mat-icon>                    
                    </button>                
                </div>
            </form>
        </mat-step>
    </mat-horizontal-stepper>
    </div>
</div>